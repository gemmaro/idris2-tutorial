# packとIdris2で始めよう

ここでは筆者が思うIdrisの使い始めるための最も便利な方法について書きます。[pack](https://github.com/stefan-hoeck/idris2-pack)パッケージ管理をインストールしていきますが、これは道中で最近のバージョンのIdrisコンパイラをインストールします。しかしこの管理方法を使うには、LinuxやmacOSのようなUnixに類するオペレーティングシステムにアクセスする必要があります。Windows利用者は[WSL](https://learn.microsoft.com/en-us/windows/wsl/about)を活用してWindowsシステム上でLinux環境にアクセスすることができます。事前要件として読者は端末セッションをシステム上で開始する方法と端末のコマンドラインからコマンドを走らせる方法がわかっていることを前提とします。加えて読者はシステム上で[`$PATH`変数](https://en.wikipedia.org/wiki/PATH_(variable))へディレクトリを加える方法も知っておく必要があります。

## packをインストールする

最新版のIdrisコンパイラと共に*pack*パッケージ管理をインストールするためには、[packのGitHubページ](https://github.com/stefan-hoeck/idris2-pack/blob/main/INSTALL.md)にある説明に従ってください。

全部うまくいったら、少し時間を取って大域的な`pack.toml`ファイルで使える既定の設定を調べることをお勧めします。この設定ファイルは`$HOME/.pack/usr/pack.toml`にあります（ただし`$PACK_DIR`環境変数を別のディレクトリに明示的に設定している場合はこの限りではありません）。可能であれば*rlwrap*ツールをインストールし、大域的な`pack.toml`ファイルで以下の設定を`true`にすることをお勧めします。

```toml
repl.rlwrap = true
```

こうするとREPLセッションを走らせるときにより良い体験が得られるようになります。また、エディタを設定してIdrisが提供する対話的な編集機能を活用したいかもしれません。Neovimについてこれをするための説明は[こちら](Neovim.md)にあります。

### packとIdrisを更新する

packとIdrisコンパイラの両プロジェクトは今も尚活発に開発されています。したがって定期的に更新するのが良い考えです。pack自体を更新するには以下のコマンドを走らせるだけです。

```sh
pack update
```

Idrisコンパイラの最新コミットをビルドしてインストールし、最新のパッケージコレクションを使うには以下を走らせます。

```sh
pack switch latest
```

## 練習場を準備する

この入門にある演習を解いていく場合は（というか解くべきです！）、沢山のコードを書いていくことになります。Idrisをいじくり回す上では小さな練習場プロジェクトを立ち上げておくのが一番です。ディレクトリを決めて以下のコマンドを走らせてください。

```sh
pack new lib tut
```

こうするとディレクトリ`tut`に最小のIdrisパッケージが立ち上がります。このディレクトリには、`tut.ipkg`という名前の`.ipkg`ファイル、`src`という名前のIdrisのソースを置くディレクトリ、`src/Tut.idr`にある最小限のIdrisのモジュールが含まれます。

加えてディレクトリ`test`に最小限のテストスートが準備されています。プロジェクトのルートディレクトリにある`pack.toml`ファイルによって、packがこのテスト全てに関する情報をまとめてアクセスできるようになるのです。少し時間を取ってpackによって作られたファイルを1つ1つ目を通してみてください。`.idr`ファイルにはIdrisで書かれたソースコードが含まれます。`.ipkg`ファイルにはIdrisコンパイラ用のパッケージの詳細が含まれており、ソースが置かれている場所、そのパッケージが他のプロジェクトでも利用できるようにしているモジュール、プロジェクト自体が依存しているパッケージの一覧といったものがあります。最後に`pack.toml`ファイルは現在のプロジェクト中のローカルなパッケージについてpackに伝えるはたらきがあります。

ここを踏まえると、以下のような沢山のことができます。でもまずはこれらのコマンドを走らせる際に、プロジェクトのルートディレクトリ（ここまでのお勧めの方法にしたがっていた場合は`tut`という名前です）かその子フォルダのうちどれかにいることを確かめてください。

ライブラリのソースの型検査をしたければ以下を走らせます。

```sh
pack typecheck tut
```

テストスートをビルドして実行するには以下を走らせます。

```sh
pack test tut
```

`src/Tut.idr`が読み込まれた状態でREPLセッションを始めるには以下を走らせます。

```sh
pack repl src/Tut.idr
```

## まとめ

このごく短い導入ではIdrisのプロジェクトで作業し入門の主部を読み進めるための環境を立ち上げました。これで[最初の章](../Tutorial/Intro.md)から始める準備ができました。もしくは、既にいくらかIdrisのコードを書いたことがあるなら、[Idrisのモジュールシステム](Modules.md)の詳細を学んでもよいでしょう。

なお、この入門自体もまたpackのプロジェクトとして立ち上げたものだったりします。ルートディレクトリ（これらのファイルを眺めて、どのようにプロジェクトが立ち上げられているのか雰囲気を掴んでください）には`pack.toml`と`tutorial.ipkg`ファイルが含まれており、ディレクトリ`src`のサブフォルダには沢山のIdrisのソースがあります。
